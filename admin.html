<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í–‰ë°¥ ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f5; }
    h1 { margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
    th { background: #111827; color: white; }
    select { padding: 6px; }
    button { padding: 6px 10px; cursor: pointer; }
    #login-box { margin: 60px auto; width: 300px; background:white; padding:20px; border-radius:10px; }
    #admin-panel { display:none; }
  </style>
</head>
<body>

<div id="login-box">
  <h3>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
  <input id="admin-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width:100%; padding:6px;">
  <button onclick="verifyPassword()" style="margin-top:10px;width:100%;">ë¡œê·¸ì¸</button>
</div>

<div id="admin-panel">
  <h1>ğŸ“¦ í–‰ë°¥ ì£¼ë¬¸ ê´€ë¦¬</h1>
  <table>
    <thead>
      <tr>
        <th>ì‹œê°„</th>
        <th>ê°€ê²Œ</th>
        <th>ë‹¨ì²´ëª…</th>
        <th>ì—°ë½ì²˜</th>
        <th>ë©”ë‰´/ìˆ˜ëŸ‰</th>
        <th>ê¸ˆì•¡</th>
        <th>ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody id="order-list"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const PASSWORD = "hangbab-admin";  // â— ì´ê±¸ ë„ˆ ì›í•˜ëŠ” ê±¸ë¡œ ë°”ê¿”
const client = supabase.createClient(
  "https://owfljerawghlyswtylxs.supabase.co",
  "sb_publishable_izKjuHR5y7O-xJANpPrS_A_ScU3hLrO"
);

function verifyPassword() {
  const input = document.getElementById("admin-password").value;
  if (input === PASSWORD) {
    document.getElementById("login-box").style.display = "none";
    document.getElementById("admin-panel").style.display = "block";
    loadOrders();
  } else {
    alert("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.");
  }
}

async function loadOrders() {
  const { data, error } = await client.from("orders").select("*").order("created_at", { ascending: false });

  const tableBody = document.getElementById("order-list");
  tableBody.innerHTML = "";

  data.forEach(order => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${new Date(order.created_at).toLocaleString()}</td>
      <td>${order.restaurant_name}</td>
      <td>${order.org_name}</td>
      <td>${order.contact_phone}</td>
      <td>${order.items.map(i => `${i.name} x ${i.qty}`).join("<br>")}</td>
      <td>${order.total_amount.toLocaleString()}ì›</td>
      <td>
        <select onchange="updateStatus('${order.id}', this.value)">
          <option value="pending" ${order.status==="pending"?"selected":""}>â³ ìš”ì²­ë¨</option>
          <option value="confirmed" ${order.status==="confirmed"?"selected":""}>âœ… í™•ì¸ë¨</option>
          <option value="completed" ${order.status==="completed"?"selected":""}>ğŸ‰ ì™„ë£Œ</option>
          <option value="rejected" ${order.status==="rejected"?"selected":""}>âŒ ê±°ì ˆ</option>
        </select>
      </td>
    `;
    tableBody.appendChild(row);
  });
}

async function updateStatus(id, status) {
  await client.from("orders").update({ status }).eq("id", id);
  alert("ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
</script>

</body>
</html>
